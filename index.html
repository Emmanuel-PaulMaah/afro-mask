<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Afro Mask</title>
  <style>
    body { margin: 0; overflow: hidden; }
    video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    img { position: absolute; top: 0; left: 0; pointer-events: none; }
  </style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<img id="mask" src="mask.png" width="200" />

<script type="module">
  import { FaceMesh } from 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js';

  const video = document.getElementById('video');
  const mask = document.getElementById('mask');

  // Start webcam
  navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    video.srcObject = stream;
  });

  // Setup FaceMesh
  const faceMesh = new FaceMesh({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
  });

  faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
  });

  faceMesh.onResults(results => {
    if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
      const landmarks = results.multiFaceLandmarks[0];

      // Head position approximation: nose tip
      const nose = landmarks[1]; // x, y normalized
      const x = nose.x * window.innerWidth - mask.width / 2;
      const y = nose.y * window.innerHeight - mask.height / 2;

      mask.style.left = `${x}px`;
      mask.style.top = `${y}px`;

      // Estimate simple yaw from left/right eye corners
      const left = landmarks[33];
      const right = landmarks[263];
      const angle = Math.atan2(right.y - left.y, right.x - left.x);
      mask.style.transform = `translate(-50%, -50%) rotate(${angle}rad)`;
    }
  });

  async function runFaceMesh() {
    const videoWidth = video.videoWidth;
    const videoHeight = video.videoHeight;
    video.width = videoWidth;
    video.height = videoHeight;

    async function frame() {
      await faceMesh.send({ image: video });
      requestAnimationFrame(frame);
    }
    frame();
  }

  video.onloadeddata = () => runFaceMesh();
</script>

</body>
</html>
